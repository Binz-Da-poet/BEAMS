generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== USER MANAGEMENT =====
model User {
  id          Int       @id @default(autoincrement())
  username    String    @unique
  password    String // Should be hashed before storage
  email       String?   @unique
  phone       String?
  role        UserRole  @default(STORE)
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  storeId          Int?
  store            Store?         @relation(fields: [storeId], references: [id])
  orderLogs        OrderLog[]
  notifications    Notification[]
  createdOrders    Order[]        @relation("OrderCreatedBy")
  updatedOrders    Order[]        @relation("OrderUpdatedBy")
  deletedStores    Store[]        @relation("StoreDeletedBy")
  deletedCustomers Customer[]     @relation("CustomerDeletedBy")

  @@map("t_users")
}

// User roles managed via enum UserRole (ADMIN, STORE, FACTORY_STAFF)

// ===== ORDER STATUS MANAGEMENT =====
model OrderStatus {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  code        String  @unique
  description String?
  isActive    Boolean @default(true)
  sortOrder   Int     @default(0)
  color       String? // For UI display

  // Relations
  mCodeId   Int?       @map("m_code_id")
  mCode     MCode?     @relation("OrderStatusCode", fields: [mCodeId], references: [id])
  orders    Order[]
  orderLogs OrderLog[]

  @@map("t_order_statuses")
}

// ===== ORDER WORKFLOW TRACKING =====
model OrderLog {
  id          Int      @id @default(autoincrement())
  orderId     Int
  userId      Int
  statusId    Int
  action      String // "CREATED", "UPDATED", "STATUS_CHANGED", "PDF_GENERATED"
  description String?
  oldValues   Json?    @db.Json // Store previous values (max 1MB)
  newValues   Json?    @db.Json // Store new values (max 1MB)
  createdAt   DateTime @default(now())

  // Relations
  order  Order       @relation(fields: [orderId], references: [id])
  user   User        @relation(fields: [userId], references: [id])
  status OrderStatus @relation(fields: [statusId], references: [id])

  @@index([orderId, createdAt])
  @@index([userId, createdAt])
  @@index([statusId, createdAt])
  @@map("t_order_logs")
}

// ===== PDF DOCUMENT MANAGEMENT =====
model Document {
  id          Int      @id @default(autoincrement())
  orderId     Int
  typeId      Int
  type        MCode?   @relation("DocumentTypeCode", fields: [typeId], references: [id])
  fileName    String
  filePath    String
  fileSize    Int?
  generatedAt DateTime @default(now())
  generatedBy Int // User ID

  // Relations
  order Order @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([typeId])
  @@map("t_documents")
}

// DocumentType moved to MCode table with category "DOCUMENT_TYPE"

// ===== NOTIFICATION SYSTEM =====
model Notification {
  id        Int       @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  typeId    Int
  type      MCode?    @relation("NotificationTypeCode", fields: [typeId], references: [id])
  isRead    Boolean   @default(false)
  data      Json?     @db.Json // Additional data (max 1MB)
  createdAt DateTime  @default(now())
  readAt    DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId, isRead])
  @@index([createdAt])
  @@map("t_notifications")
}

// NotificationType moved to MCode table with category "NOTIFICATION_TYPE"

// ===== MASTER CODE MANAGEMENT =====
model MCode {
  id          Int      @id @default(autoincrement())
  category    String // "ITEM_TYPE", "PLAN", "PICKUP_METHOD", "ORIENTATION", "SEASON", "SUPPLIER", "NOTIFICATION_TYPE", "DOCUMENT_TYPE", "ORDER_PRIORITY"
  code        String
  name        String
  description String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  metadata    Json?    @db.Json // Additional data for specific codes (max 1MB)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  orderPlanCodes                     Order[]           @relation("OrderPlanCode")
  orderPickupMethodCodes             Order[]           @relation("OrderPickupMethodCode")
  orderPriorityCodes                 Order[]           @relation("OrderPriorityCode")
  orderItemTypeCodes                 Order[]           @relation("OrderItemTypeCode")
  measurementTypeItemTypeCodes       MeasurementType[] @relation("MeasurementTypeItemTypeCode")
  patternMasterItemTypeCodes         PatternMaster[]   @relation("PatternMasterItemTypeCode")
  coatSeasonCodes                    CoatDetails[]     @relation("CoatSeasonCode")
  suitSeasonCodes                    SuitDetails[]     @relation("SuitSeasonCode")
  pantsSeasonCodes                   PantsDetails[]    @relation("PantsSeasonCode")
  vestSeasonCodes                    VestDetails[]     @relation("VestSeasonCode")
  jacketBodyLiningOrientationCodes   JacketDetails[]   @relation("JacketBodyLiningOrientationCode")
  jacketSleeveLiningOrientationCodes JacketDetails[]   @relation("JacketSleeveLiningOrientationCode")
  coatBodyLiningOrientationCodes     CoatDetails[]     @relation("CoatBodyLiningOrientationCode")
  coatSleeveLiningOrientationCodes   CoatDetails[]     @relation("CoatSleeveLiningOrientationCode")
  suitBodyLiningOrientationCodes     SuitDetails[]     @relation("SuitBodyLiningOrientationCode")
  suitSleeveLiningOrientationCodes   SuitDetails[]     @relation("SuitSleeveLiningOrientationCode")
  vestBodyLiningOrientationCodes     VestDetails[]     @relation("VestBodyLiningOrientationCode")
  orderStatuses                      OrderStatus[]     @relation("OrderStatusCode")
  documents                          Document[]        @relation("DocumentTypeCode")
  notifications                      Notification[]    @relation("NotificationTypeCode")

  @@unique([category, code])
  @@index([category])
  @@index([isActive])
  @@map("m_codes")
}

// ===== ENHANCED STORE MODEL =====
model Store {
  id      Int     @id @default(autoincrement())
  name    String
  code    String? @unique
  address String?
  phone   String?
  email   String?

  // Enhanced fields
  isActive    Boolean   @default(true)
  region      String?
  managerName String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  deletedBy   Int?

  // Relations
  orders        Order[]
  staff         Staff[]
  users         User[]
  deletedByUser User?   @relation("StoreDeletedBy", fields: [deletedBy], references: [id])

  @@map("t_stores")
}

// ===== ENHANCED CUSTOMER MODEL =====
model Customer {
  id    Int     @id @default(autoincrement())
  name  String
  kana  String?
  phone String?
  email String?
  note  String?

  // Enhanced fields
  customerCode String?   @unique
  birthDate    DateTime?
  address      String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?
  deletedBy    Int?

  // Relations
  orders        Order[]
  deletedByUser User?   @relation("CustomerDeletedBy", fields: [deletedBy], references: [id])

  @@map("t_customers")
}

// ===== ENHANCED ORDER MODEL =====
model Order {
  id                       Int       @id @default(autoincrement())
  storeId                  Int
  customerId               Int
  planCodeId               Int
  statusId                 Int       @default(1) // Default to first status
  receptionDate            DateTime
  expectedStoreArrivalDate DateTime?
  pickupMethodCodeId       Int?
  salesPrice               Decimal? // Must be >= 0
  orderNo                  String?   @unique
  notes                    String?

  // Enhanced fields
  priorityId              Int       @default(2) // Default to NORMAL priority
  priority                MCode?    @relation("OrderPriorityCode", fields: [priorityId], references: [id])
  estimatedCompletionDate DateTime?
  actualCompletionDate    DateTime?
  isUrgent                Boolean   @default(false)
  internalNotes           String? // Ghi chú nội bộ

  // Item fields (moved from OrderItem)
  itemTypeCodeId   Int
  staffId          Int?
  quantity         Int       @default(1) // Must be > 0
  unitPrice        Decimal? // Must be >= 0
  orderPeriodStart DateTime?
  orderPeriodEnd   DateTime?

  // Audit fields
  createdBy Int
  updatedBy Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  customer         Customer       @relation(fields: [customerId], references: [id])
  planCode         MCode          @relation("OrderPlanCode", fields: [planCodeId], references: [id])
  pickupMethodCode MCode?         @relation("OrderPickupMethodCode", fields: [pickupMethodCodeId], references: [id])
  store            Store          @relation(fields: [storeId], references: [id])
  status           OrderStatus    @relation(fields: [statusId], references: [id])
  createdByUser    User           @relation("OrderCreatedBy", fields: [createdBy], references: [id])
  updatedByUser    User?          @relation("OrderUpdatedBy", fields: [updatedBy], references: [id])
  itemTypeCode     MCode          @relation("OrderItemTypeCode", fields: [itemTypeCodeId], references: [id])
  staff            Staff?         @relation(fields: [staffId], references: [id])
  jacketDetails    JacketDetails?
  coatDetails      CoatDetails?
  suitDetails      SuitDetails?
  pantsDetails     PantsDetails?
  vestDetails      VestDetails?
  logs             OrderLog[]
  documents        Document[]

  // Indexes for performance
  @@index([orderNo])
  @@index([statusId, createdAt])
  @@index([storeId, statusId, createdAt])
  @@index([customerId, createdAt])
  @@index([createdBy, createdAt])
  @@index([priorityId, createdAt])
  @@index([itemTypeCodeId])
  @@index([staffId])
  @@map("t_orders")
}

// OrderPriority moved to MCode table with category "ORDER_PRIORITY"

// ===== EXISTING MODELS (KEEPING EXISTING STRUCTURE) =====
model Staff {
  id      Int     @id @default(autoincrement())
  storeId Int
  name    String
  email   String?
  phone   String?
  role    String?
  orders  Order[]
  store   Store   @relation(fields: [storeId], references: [id])

  @@map("t_staff")
}

model JacketDetails {
  orderId                       Int      @id
  fabricId                      Int?
  patternId                     Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  buttonId                      Int?
  buttonColorNo                 String?
  optionsId                     Int?
  optionsText                   String?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  sizeLabel                     String?
  bastedFitting                 Boolean?
  remarks                       String?

  // Relations to measurements
  measurements Measurement[] @relation("JacketMeasurements")

  // Relations
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("JacketBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                      HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pattern                     PatternMaster?           @relation(fields: [patternId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("JacketSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])

  @@map("t_jacket_details")
}

// ===== UNIFIED MEASUREMENT TYPE =====
model MeasurementType {
  id             Int      @id @default(autoincrement())
  itemTypeCodeId Int
  code           String   @unique
  name           String
  unit           String?
  isActive       Boolean  @default(true)
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  itemTypeCode MCode         @relation("MeasurementTypeItemTypeCode", fields: [itemTypeCodeId], references: [id])
  measurements Measurement[]

  @@index([itemTypeCodeId])
  @@index([code])
  @@map("m_measurement_type")
}

// ===== UNIFIED MEASUREMENT TABLE =====
model Measurement {
  id            Int      @id @default(autoincrement())
  detailsId     Int // FK to any Details table
  detailsType   String // "JACKET", "COAT", "SUIT", "PANTS", "VEST"
  typeId        Int // FK to MeasurementType
  standardValue Decimal? @db.Decimal(10, 2)
  adjustValue   Decimal? @db.Decimal(10, 2)
  finalValue    Decimal? @db.Decimal(10, 2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  type          MeasurementType @relation(fields: [typeId], references: [id])
  jacketDetails JacketDetails?  @relation("JacketMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementJacketDetails")
  coatDetails   CoatDetails?    @relation("CoatMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementCoatDetails")
  suitDetails   SuitDetails?    @relation("SuitMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementSuitDetails")
  pantsDetails  PantsDetails?   @relation("PantsMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementPantsDetails")
  vestDetails   VestDetails?    @relation("VestMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementVestDetails")

  @@unique([detailsId, detailsType, typeId])
  @@index([detailsId, detailsType])
  @@index([typeId])
  @@map("t_measurements")
}

model CoatDetails {
  orderId                       Int      @id
  seasonCodeId                  Int?
  supplierId                    Int?
  fabricId                      Int?
  patternId                     Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  buttonId                      Int?
  buttonColorNo                 String?
  optionsId                     Int?
  optionsText                   String?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  sizeLabel                     String?
  bastedFitting                 Boolean?
  remarks                       String?

  // Relations to measurements
  measurements Measurement[] @relation("CoatMeasurements")

  // Relations
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("CoatBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                      HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pattern                     PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode                  MCode?                   @relation("CoatSeasonCode", fields: [seasonCodeId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("CoatSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])
  supplier                    Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_coat_details")
}

model HeavyFabricMaster {
  id                     Int       @id @default(autoincrement())
  fabricMaker            String?
  fabricNo               String    @unique
  color                  String?
  pattern                String?
  composition            String?
  characteristics        String?
  fairFabricUnitPrice    Decimal?
  fairFabricRank         String?
  regularFabricUnitPrice Decimal?
  regularFabricRank      String?
  dataUpdated            DateTime?
  largePattern           Boolean?
  transparent            Boolean?
  stockFlag              Boolean?
  supplierId             Int

  // Audit fields
  createdBy Int?
  updatedBy Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  coatDetails   CoatDetails[]
  supplier      Supplier        @relation(fields: [supplierId], references: [id])
  jacketDetails JacketDetails[]
  pantsDetails  PantsDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@index([fabricNo])
  @@index([supplierId])
  @@index([createdAt])
  @@map("m_heavy_fabric")
}

// ===== UNIFIED PATTERN MASTER =====
model PatternMaster {
  id                 Int      @id @default(autoincrement())
  itemTypeCodeId     Int
  patternNo          String   @unique
  size               String?
  length             Decimal?
  shoulderWidth      Decimal?
  bust               Decimal?
  waist              Decimal?
  hip                Decimal?
  sleeveLength       Decimal?
  sleeveWidth        Decimal?
  lapelWidth         Decimal?
  crotchWidth        Decimal? // For pants
  kneeWidth          Decimal? // For pants
  hemWidth           Decimal? // For pants
  rise               Decimal? // For pants
  inseam             Decimal? // For pants
  stitchSpec         String?
  liningSpec         String?
  defaultButtonCount Int?
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Relations
  itemTypeCode      MCode           @relation("PatternMasterItemTypeCode", fields: [itemTypeCodeId], references: [id])
  jacketDetails     JacketDetails[]
  coatDetails       CoatDetails[]
  suitJacketDetails SuitDetails[]   @relation("SuitJacketPattern")
  suitPantsDetails  SuitDetails[]   @relation("SuitPantsPattern")
  vestDetails       VestDetails[]
  pantsDetails      PantsDetails[]

  @@index([itemTypeCodeId])
  @@index([patternNo])
  @@map("m_pattern")
}

// Legacy Pattern Master tables removed - use unified PatternMaster instead

model BodyLiningMaster {
  id            Int             @id @default(autoincrement())
  productNo     String          @unique
  colorNo       String?
  orientation   String?
  stockFlag     Boolean?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@map("m_body_lining")
}

model SleeveLiningMaster {
  id            Int             @id @default(autoincrement())
  productNo     String          @unique
  colorNo       String?
  orientation   String?
  stockFlag     Boolean?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  suitDetails   SuitDetails[]

  @@map("m_sleeve_lining")
}

model HeavyFabricButtonMaster {
  id                Int             @id @default(autoincrement())
  productNo         String
  colorNo           String?
  pantsProductNo    String?
  pantsColorNo      String?
  cost1             Decimal?
  cost2             Decimal?
  cost3             Decimal?
  cost4             Decimal?
  cost5             Decimal?
  cost6             Decimal?
  cost7             Decimal?
  cost8             Decimal?
  retailPrice1      Decimal?
  retailPrice2      Decimal?
  retailPrice3      Decimal?
  retailPrice4      Decimal?
  retailPrice5      Decimal?
  retailPrice6      Decimal?
  retailPrice7      Decimal?
  retailPrice8      Decimal?
  coatDetails       CoatDetails[]
  jacketDetails     JacketDetails[]
  pantsDetails      PantsDetails[]
  suitJacketDetails SuitDetails[]   @relation("SuitJacketButton")
  suitPantsDetails  SuitDetails[]   @relation("SuitPantsButton")
  vestDetails       VestDetails[]

  @@map("m_heavy_fabric_button")
}

model OptionMaster {
  id            Int             @id @default(autoincrement())
  optionName    String
  cost          Decimal?
  retailPrice   Decimal?
  textContent   String?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  pantsDetails  PantsDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@map("m_option")
}

model Supplier {
  id              Int                 @id @default(autoincrement())
  supplierNo      String              @unique @map("supplier_no")
  supplierName    String              @map("supplier_name")
  supplierZipCode String?             @map("supplier_zip_code")
  supplierAddress String?             @map("supplier_address")
  manager         String?
  email1          String?
  email2          String?
  heavyFabrics    HeavyFabricMaster[]
  coatDetails     CoatDetails[]
  suitDetails     SuitDetails[]
  pantsDetails    PantsDetails[]
  vestDetails     VestDetails[]

  @@map("m_supplier")
}

model SuitDetails {
  orderId                       Int      @id
  seasonCodeId                  Int?
  supplierId                    Int?
  fabricId                      Int?
  jacketPatternId               Int?
  pantsPatternId                Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  jacketButtonId                Int?
  jacketButtonColorNo           String?
  pantsButtonId                 Int?
  pantsButtonColorNo            String?
  optionsId                     Int?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  jacketSizeLabel               String?
  pantsSizeLabel                String?
  pantsHemSpec                  String?
  pantsDoubleWidth              Decimal?
  bastedFitting                 Boolean?
  remarks                       String?

  // Relations to measurements
  measurements Measurement[] @relation("SuitMeasurements")

  // Relations
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("SuitBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  jacketButton                HeavyFabricButtonMaster? @relation("SuitJacketButton", fields: [jacketButtonId], references: [id])
  jacketPattern               PatternMaster?           @relation("SuitJacketPattern", fields: [jacketPatternId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pantsButton                 HeavyFabricButtonMaster? @relation("SuitPantsButton", fields: [pantsButtonId], references: [id])
  pantsPattern                PatternMaster?           @relation("SuitPantsPattern", fields: [pantsPatternId], references: [id])
  seasonCode                  MCode?                   @relation("SuitSeasonCode", fields: [seasonCodeId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("SuitSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])
  supplier                    Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_suit_details")
}

model PantsDetails {
  orderId            Int      @id
  seasonCodeId       Int?
  supplierId         Int?
  fabricId           Int?
  patternId          Int?
  liningSpec         String?
  buttonId           Int?
  pantsButtonColorNo String?
  optionsId          Int?
  pantsSizeLabel     String?
  pantsHemSpec       String?
  pantsDoubleWidth   Decimal?
  bastedFitting      Boolean?
  remarks            String?

  // Relations to measurements
  measurements Measurement[] @relation("PantsMeasurements")

  // Relations
  button     HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric     HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options    OptionMaster?            @relation(fields: [optionsId], references: [id])
  order      Order                    @relation(fields: [orderId], references: [id])
  pattern    PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode MCode?                   @relation("PantsSeasonCode", fields: [seasonCodeId], references: [id])
  supplier   Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_pants_details")
}

model VestDetails {
  orderId                     Int      @id
  seasonCodeId                Int?
  supplierId                  Int?
  fabricId                    Int?
  patternId                   Int?
  bodyLiningId                Int?
  bodyLiningColorNo           String?
  bodyLiningOrientationCodeId Int?     @map("body_lining_orientation_code_id")
  liningSpec                  String?
  buttonId                    Int?
  buttonColorNo               String?
  optionsId                   Int?
  sizeLabel                   String?
  bastedFitting               Boolean?
  remarks                     String?

  // Relations to measurements
  measurements Measurement[] @relation("VestMeasurements")

  // Relations
  bodyLining                BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode MCode?                   @relation("VestBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                    HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                    HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                   OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                     Order                    @relation(fields: [orderId], references: [id])
  pattern                   PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode                MCode?                   @relation("VestSeasonCode", fields: [seasonCodeId], references: [id])
  supplier                  Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_vest_details")
}

enum UserRole {
  ADMIN
  STORE
  FACTORY_STAFF
}
