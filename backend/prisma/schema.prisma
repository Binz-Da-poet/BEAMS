generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== ユーザー管理 =====
model User {
  id          Int       @id @default(autoincrement())
  username    String    @unique
  password    String // 保存前にハッシュ化する必要があります
  role        UserRole  @default(STORE)
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // リレーション
  storeId          Int?
  store            Store?         @relation(fields: [storeId], references: [id])
  staffId          Int?
  staff            Staff?         @relation(fields: [staffId], references: [id])
  orderLogs        OrderLog[]
  notifications    Notification[]
  deletedStores    Store[]        @relation("StoreDeletedBy")

  @@map("t_users")
}

// ユーザーロールはenum UserRole (ADMIN, STORE, FACTORY_STAFF) で管理

// ===== オーダーワークフロー追跡 =====
// OrderStatusはMCodeテーブルに移動（カテゴリ "ORDER_STATUS"）
model OrderLog {
  id          Int      @id @default(autoincrement())
  orderId     Int
  userId      Int
  statusId    Int
  action      String // "CREATED", "UPDATED", "STATUS_CHANGED", "PDF_GENERATED"
  description String?
  oldValues   Json?    @db.Json // 以前の値を保存（最大1MB）
  newValues   Json?    @db.Json // 新しい値を保存（最大1MB）
  createdAt   DateTime @default(now())

  // リレーション
  order  Order @relation(fields: [orderId], references: [id])
  user   User  @relation(fields: [userId], references: [id])
  status MCode @relation("OrderLogStatus", fields: [statusId], references: [id])

  @@index([orderId, createdAt])
  @@index([userId, createdAt])
  @@index([statusId, createdAt])
  @@map("t_order_logs")
}

// ===== PDF文書管理 =====
model Document {
  id          Int      @id @default(autoincrement())
  typeId      Int
  type        MCode?   @relation("DocumentTypeCode", fields: [typeId], references: [id])
  fileName    String
  filePath    String
  fileSize    Int?
  generatedAt DateTime @default(now())
  generatedBy Int // ユーザーID

  // リレーション
  // 注意: オーダーリレーション削除 - 文書はオーダーにリンクされなくなりました

  @@index([typeId])
  @@map("t_documents")
}

// DocumentTypeはMCodeテーブルに移動（カテゴリ "DOCUMENT_TYPE"）

// ===== 通知システム =====
model Notification {
  id        Int       @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  typeId    Int
  type      MCode?    @relation("NotificationTypeCode", fields: [typeId], references: [id])
  isRead    Boolean   @default(false)
  data      Json?     @db.Json // 追加データ（最大1MB）
  createdAt DateTime  @default(now())
  readAt    DateTime?

  // リレーション
  user User @relation(fields: [userId], references: [id])

  @@index([userId, isRead])
  @@index([createdAt])
  @@map("t_notifications")
}

// NotificationTypeはMCodeテーブルに移動（カテゴリ "NOTIFICATION_TYPE"）

// ===== マスターコード管理 =====
model MCode {
  id          Int      @id @default(autoincrement())
  category    String // "ITEM_TYPE", "PLAN", "PICKUP_METHOD", "ORIENTATION", "SEASON", "SUPPLIER", "NOTIFICATION_TYPE", "DOCUMENT_TYPE", "ORDER_STATUS"
  code        String
  name        String
  description String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  metadata    Json?    @db.Json // 特定コードの追加データ（最大1MB）
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // リレーション
  orderPlanCodes                     Order[]           @relation("OrderPlanCode")
  orderPickupMethodCodes             Order[]           @relation("OrderPickupMethodCode")
  orderItemTypeCodes                 Order[]           @relation("OrderItemTypeCode")
  orderStatusCodes                   Order[]           @relation("OrderStatus")
  orderLogStatusCodes                OrderLog[]        @relation("OrderLogStatus")
  measurementTypeItemTypeCodes       MeasurementType[] @relation("MeasurementTypeItemTypeCode")
  patternMasterItemTypeCodes         PatternMaster[]   @relation("PatternMasterItemTypeCode")
  coatSeasonCodes                    CoatDetails[]     @relation("CoatSeasonCode")
  suitSeasonCodes                    SuitDetails[]     @relation("SuitSeasonCode")
  pantsSeasonCodes                   PantsDetails[]    @relation("PantsSeasonCode")
  vestSeasonCodes                    VestDetails[]     @relation("VestSeasonCode")
  jacketBodyLiningOrientationCodes   JacketDetails[]   @relation("JacketBodyLiningOrientationCode")
  jacketSleeveLiningOrientationCodes JacketDetails[]   @relation("JacketSleeveLiningOrientationCode")
  coatBodyLiningOrientationCodes     CoatDetails[]     @relation("CoatBodyLiningOrientationCode")
  coatSleeveLiningOrientationCodes   CoatDetails[]     @relation("CoatSleeveLiningOrientationCode")
  suitBodyLiningOrientationCodes     SuitDetails[]     @relation("SuitBodyLiningOrientationCode")
  suitSleeveLiningOrientationCodes   SuitDetails[]     @relation("SuitSleeveLiningOrientationCode")
  vestBodyLiningOrientationCodes     VestDetails[]     @relation("VestBodyLiningOrientationCode")
  documents                          Document[]        @relation("DocumentTypeCode")
  notifications                      Notification[]    @relation("NotificationTypeCode")

  @@unique([category, code])
  @@index([category])
  @@index([isActive])
  @@map("m_codes")
}

// ===== 拡張ストアモデル =====
model Store {
  id      Int     @id @default(autoincrement())
  name    String
  code    String? @unique
  address String?
  phone   String?
  email   String?

  // 拡張フィールド
  isActive    Boolean   @default(true)
  region      String?
  managerName String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  deletedBy   Int?

  // リレーション
  orders        Order[]
  users         User[]
  staffOfStores StaffOfStore[]
  deletedByUser User?   @relation("StoreDeletedBy", fields: [deletedBy], references: [id])

  @@map("t_stores")
}

// ===== ストアスタッフ =====
model StaffOfStore {
  id      Int     @id @default(autoincrement())
  name    String
  phone   String?
  storeId Int

  // リレーション
  store Store  @relation(fields: [storeId], references: [id])
  orders Order[]

  @@index([storeId])
  @@map("t_staff_of_store")
}

// ===== 拡張オーダーモデル =====
model Order {
  id                       Int       @id @default(autoincrement())
  storeId                  Int
  planCodeId               Int
  statusId                 Int       @default(1) // デフォルトは最初のステータス
  receptionDate            DateTime
  expectedStoreArrivalDate DateTime?
  pickupMethodCodeId       Int?
  salesPrice               Int? // 0以上である必要があります
  orderNo                  String?   @unique
  notes                    String?

  // 顧客情報
  customerSurname          String?
  customerName             String?
  customerSurnameFurigana  String?
  customerNameFurigana     String?
  customerPhone            String?
  customerZipCode          String?
  customerAddress          String?
  beamsClubId              String?

  // 拡張フィールド
  estimatedCompletionDate DateTime?
  actualCompletionDate    DateTime?
  isUrgent                Boolean   @default(false)
  internalNotes           String? // 内部メモ

  // アイテムフィールド（OrderItemから移動）
  itemTypeCodeId   Int
  staffOfStoreId   Int?
  unitPrice        Int? // 0以上である必要があります
  orderPeriodStart DateTime?
  orderPeriodEnd   DateTime?

  // 監査フィールド
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // リレーション
  planCode         MCode          @relation("OrderPlanCode", fields: [planCodeId], references: [id])
  pickupMethodCode MCode?         @relation("OrderPickupMethodCode", fields: [pickupMethodCodeId], references: [id])
  store            Store          @relation(fields: [storeId], references: [id])
  status           MCode          @relation("OrderStatus", fields: [statusId], references: [id])
  itemTypeCode     MCode          @relation("OrderItemTypeCode", fields: [itemTypeCodeId], references: [id])
  staffOfStore     StaffOfStore?  @relation(fields: [staffOfStoreId], references: [id])
  
  // Detailsリレーション - itemTypeCodeIdに基づいて、オーダーごとに1つのDetailsのみ
  // アプリケーションレベルでの検証が必要（1つのDetailsのみが作成されることを保証）
  // 例: itemTypeCodeId = JACKETの場合、jacketDetailsのみが存在すべき
  jacketDetails    JacketDetails?  // itemTypeCodeId = JACKETの場合のみ
  coatDetails      CoatDetails?    // itemTypeCodeId = COATの場合のみ
  suitDetails      SuitDetails?    // itemTypeCodeId = SUITの場合のみ
  pantsDetails     PantsDetails?   // itemTypeCodeId = PANTSの場合のみ
  vestDetails      VestDetails?    // itemTypeCodeId = VESTの場合のみ
  
  logs             OrderLog[]

  // パフォーマンス用インデックス
  @@index([orderNo])
  @@index([statusId, createdAt])
  @@index([storeId, statusId, createdAt])
  @@index([itemTypeCodeId])
  @@index([staffOfStoreId])
  @@map("t_orders")
}

// ===== 既存モデル（既存構造を維持） =====
model Staff {
  id          Int     @id @default(autoincrement())
  staffNumber String  @unique @map("staff_number")
  name        String
  email       String?
  phone       String?
  users       User[]

  @@map("t_staff")
}

model JacketDetails {
  orderId                       Int      @id
  fabricId                      Int?
  patternId                     Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  buttonId                      Int?
  buttonColorNo                 String?
  optionsId                     Int?
  optionsText                   String?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  sizeLabel                     String?
  bastedFitting                 Boolean?
  remarks                       String?

  // 測定へのリレーション
  measurements Measurement[] @relation("JacketMeasurements")

  // リレーション
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("JacketBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                      HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pattern                     PatternMaster?           @relation(fields: [patternId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("JacketSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])

  @@map("t_jacket_details")
}

// ===== 統一測定タイプ =====
model MeasurementType {
  id             Int      @id @default(autoincrement())
  itemTypeCodeId Int
  code           String   @unique
  name           String
  unit           String?
  isActive       Boolean  @default(true)
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // リレーション
  itemTypeCode MCode         @relation("MeasurementTypeItemTypeCode", fields: [itemTypeCodeId], references: [id])
  measurements Measurement[]

  @@index([itemTypeCodeId])
  @@index([code])
  @@map("m_measurement_type")
}

// ===== 統一測定テーブル =====
model Measurement {
  id            Int      @id @default(autoincrement())
  detailsId     Int // DetailsテーブルへのFK（orderId）
  typeId        Int // MeasurementTypeへのFK
  standardValue Decimal? @db.Decimal(10, 2)
  adjustValue   Decimal? @db.Decimal(10, 2)
  finalValue    Decimal? @db.Decimal(10, 2)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // リレーション
  // 注意: 各Measurementは1つのDetailsテーブルのみに関連付けられます
  // アプリケーションレベルでの検証が必要（1つのrelationのみが設定されることを保証）
  type          MeasurementType @relation(fields: [typeId], references: [id])
  jacketDetails JacketDetails?   @relation("JacketMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementJacketDetails")
  coatDetails   CoatDetails?     @relation("CoatMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementCoatDetails")
  suitDetails   SuitDetails?     @relation("SuitMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementSuitDetails")
  pantsDetails  PantsDetails?   @relation("PantsMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementPantsDetails")
  vestDetails   VestDetails?     @relation("VestMeasurements", fields: [detailsId], references: [orderId], map: "MeasurementVestDetails")

  @@unique([detailsId, typeId])
  @@index([detailsId])
  @@index([typeId])
  @@map("t_measurements")
}

model CoatDetails {
  orderId                       Int      @id
  seasonCodeId                  Int?
  supplierId                    Int?
  fabricId                      Int?
  patternId                     Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  buttonId                      Int?
  buttonColorNo                 String?
  optionsId                     Int?
  optionsText                   String?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  sizeLabel                     String?
  bastedFitting                 Boolean?
  remarks                       String?

  // 測定へのリレーション
  measurements Measurement[] @relation("CoatMeasurements")

  // リレーション
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("CoatBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                      HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pattern                     PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode                  MCode?                   @relation("CoatSeasonCode", fields: [seasonCodeId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("CoatSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])
  supplier                    Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_coat_details")
}

model HeavyFabricMaster {
  id                     Int       @id @default(autoincrement())
  fabric_manufacturer    String?
  fabric_no              String    @unique
  color                  String?
  fabric_pattern         String?
  composition            String?
  fabric_properties      String?
  fair_fabric_price      Int?
  fair_fabric_rank       String?
  regular_fabric_price   Int?
  regular_fabric_rank    String?
  fabric_data_update     DateTime?
  large                  Boolean?
  fabric_sheer           Boolean?
  stock_flag             Boolean?
  supplierId             Int

  // 監査フィールド
  createdBy Int?
  updatedBy Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // リレーション
  coatDetails   CoatDetails[]
  supplier      Supplier        @relation(fields: [supplierId], references: [id])
  jacketDetails JacketDetails[]
  pantsDetails  PantsDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@index([fabric_no])
  @@index([supplierId])
  @@index([createdAt])
  @@map("m_heavy_fabric")
}

// ===== 統一パターンマスター =====
model PatternMaster {
  id                 Int      @id @default(autoincrement())
  itemTypeCodeId     Int
  patternNo          String   @unique
  size               String?
  length             Decimal?
  shoulderWidth      Decimal?
  bust               Decimal?
  waist              Decimal?
  hip                Decimal?
  sleeveLength       Decimal?
  sleeveWidth        Decimal?
  lapelWidth         Decimal?
  crotchWidth        Decimal? // パンツ用
  kneeWidth          Decimal? // パンツ用
  hemWidth           Decimal? // パンツ用
  rise               Decimal? // パンツ用
  inseam             Decimal? // パンツ用
  stitchSpec         String?
  liningSpec         String?
  defaultButtonCount Int?
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // リレーション
  itemTypeCode      MCode           @relation("PatternMasterItemTypeCode", fields: [itemTypeCodeId], references: [id])
  jacketDetails     JacketDetails[]
  coatDetails       CoatDetails[]
  suitJacketDetails SuitDetails[]   @relation("SuitJacketPattern")
  suitPantsDetails  SuitDetails[]   @relation("SuitPantsPattern")
  vestDetails       VestDetails[]
  pantsDetails      PantsDetails[]

  @@index([itemTypeCodeId])
  @@index([patternNo])
  @@map("m_pattern")
}

// レガシーパターンマスターテーブルは削除 - 統一PatternMasterを使用

model BodyLiningMaster {
  id            Int             @id @default(autoincrement())
  productNo     String          @unique
  colorNo       String?
  orientation   String?
  stockFlag     Boolean?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@map("m_body_lining")
}

model SleeveLiningMaster {
  id            Int             @id @default(autoincrement())
  productNo     String          @unique
  colorNo       String?
  orientation   String?
  stockFlag     Boolean?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  suitDetails   SuitDetails[]

  @@map("m_sleeve_lining")
}

model HeavyFabricButtonMaster {
  id                Int             @id @default(autoincrement())
  productNo         String
  colorNo           String?
  pantsProductNo    String?
  pantsColorNo      String?
  cost1             Int?
  cost2             Int?
  cost3             Int?
  cost4             Int?
  cost5             Int?
  cost6             Int?
  cost7             Int?
  cost8             Int?
  retailPrice1      Int?
  retailPrice2      Int?
  retailPrice3      Int?
  retailPrice4      Int?
  retailPrice5      Int?
  retailPrice6      Int?
  retailPrice7      Int?
  retailPrice8      Int?
  coatDetails       CoatDetails[]
  jacketDetails     JacketDetails[]
  pantsDetails      PantsDetails[]
  suitJacketDetails SuitDetails[]   @relation("SuitJacketButton")
  suitPantsDetails  SuitDetails[]   @relation("SuitPantsButton")
  vestDetails       VestDetails[]

  @@map("m_heavy_fabric_button")
}

model OptionMaster {
  id            Int             @id @default(autoincrement())
  optionName    String
  cost          Int?
  retailPrice   Int?
  textContent   String?
  coatDetails   CoatDetails[]
  jacketDetails JacketDetails[]
  pantsDetails  PantsDetails[]
  suitDetails   SuitDetails[]
  vestDetails   VestDetails[]

  @@map("m_option")
}

model Supplier {
  id              Int                 @id @default(autoincrement())
  supplierNo      String              @unique @map("supplier_no")
  supplierName    String              @map("supplier_name")
  supplierZipCode String?             @map("supplier_zip_code")
  supplierAddress String?             @map("supplier_address")
  manager         String?
  email1          String?
  email2          String?
  heavyFabrics    HeavyFabricMaster[]
  coatDetails     CoatDetails[]
  suitDetails     SuitDetails[]
  pantsDetails    PantsDetails[]
  vestDetails     VestDetails[]

  @@map("m_supplier")
}

model SuitDetails {
  orderId                       Int      @id
  seasonCodeId                  Int?
  supplierId                    Int?
  fabricId                      Int?
  jacketPatternId               Int?
  pantsPatternId                Int?
  bodyLiningId                  Int?
  bodyLiningColorNo             String?
  bodyLiningOrientationCodeId   Int?     @map("body_lining_orientation_code_id")
  sleeveLiningId                Int?
  sleeveLiningColorNo           String?
  sleeveLiningOrientationCodeId Int?     @map("sleeve_lining_orientation_code_id")
  liningSpec                    String?
  jacketButtonId                Int?
  jacketButtonColorNo           String?
  pantsButtonId                 Int?
  pantsButtonColorNo            String?
  optionsId                     Int?
  cuffSpec                      String?
  cuffButtonCount               Int?
  cuffButtonStartPos            Decimal?
  jacketSizeLabel               String?
  pantsSizeLabel                String?
  pantsHemSpec                  String?
  pantsDoubleWidth              Decimal?
  bastedFitting                 Boolean?
  remarks                       String?

  // 測定へのリレーション
  measurements Measurement[] @relation("SuitMeasurements")

  // リレーション
  bodyLining                  BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode   MCode?                   @relation("SuitBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  fabric                      HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  jacketButton                HeavyFabricButtonMaster? @relation("SuitJacketButton", fields: [jacketButtonId], references: [id])
  jacketPattern               PatternMaster?           @relation("SuitJacketPattern", fields: [jacketPatternId], references: [id])
  options                     OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                       Order                    @relation(fields: [orderId], references: [id])
  pantsButton                 HeavyFabricButtonMaster? @relation("SuitPantsButton", fields: [pantsButtonId], references: [id])
  pantsPattern                PatternMaster?           @relation("SuitPantsPattern", fields: [pantsPatternId], references: [id])
  seasonCode                  MCode?                   @relation("SuitSeasonCode", fields: [seasonCodeId], references: [id])
  sleeveLining                SleeveLiningMaster?      @relation(fields: [sleeveLiningId], references: [id])
  sleeveLiningOrientationCode MCode?                   @relation("SuitSleeveLiningOrientationCode", fields: [sleeveLiningOrientationCodeId], references: [id])
  supplier                    Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_suit_details")
}

model PantsDetails {
  orderId            Int      @id
  seasonCodeId       Int?
  supplierId         Int?
  fabricId           Int?
  patternId          Int?
  liningSpec         String?
  buttonId           Int?
  pantsButtonColorNo String?
  optionsId          Int?
  pantsSizeLabel     String?
  pantsHemSpec       String?
  pantsDoubleWidth   Decimal?
  bastedFitting      Boolean?
  remarks            String?

  // 測定へのリレーション
  measurements Measurement[] @relation("PantsMeasurements")

  // リレーション
  button     HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric     HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options    OptionMaster?            @relation(fields: [optionsId], references: [id])
  order      Order                    @relation(fields: [orderId], references: [id])
  pattern    PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode MCode?                   @relation("PantsSeasonCode", fields: [seasonCodeId], references: [id])
  supplier   Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_pants_details")
}

model VestDetails {
  orderId                     Int      @id
  seasonCodeId                Int?
  supplierId                  Int?
  fabricId                    Int?
  patternId                   Int?
  bodyLiningId                Int?
  bodyLiningColorNo           String?
  bodyLiningOrientationCodeId Int?     @map("body_lining_orientation_code_id")
  liningSpec                  String?
  buttonId                    Int?
  buttonColorNo               String?
  optionsId                   Int?
  sizeLabel                   String?
  bastedFitting               Boolean?
  remarks                     String?

  // 測定へのリレーション
  measurements Measurement[] @relation("VestMeasurements")

  // リレーション
  bodyLining                BodyLiningMaster?        @relation(fields: [bodyLiningId], references: [id])
  bodyLiningOrientationCode MCode?                   @relation("VestBodyLiningOrientationCode", fields: [bodyLiningOrientationCodeId], references: [id])
  button                    HeavyFabricButtonMaster? @relation(fields: [buttonId], references: [id])
  fabric                    HeavyFabricMaster?       @relation(fields: [fabricId], references: [id])
  options                   OptionMaster?            @relation(fields: [optionsId], references: [id])
  order                     Order                    @relation(fields: [orderId], references: [id])
  pattern                   PatternMaster?           @relation(fields: [patternId], references: [id])
  seasonCode                MCode?                   @relation("VestSeasonCode", fields: [seasonCodeId], references: [id])
  supplier                  Supplier?                @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@map("t_vest_details")
}

enum UserRole {
  ADMIN
  STORE
  FACTORY_STAFF
}
